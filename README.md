# 42-Born 2 be Root

## ***** creation Virtual Machine ***** <br>
download Debien from Debien.org <br>

Open VM <br>
bar de menu -> Machine -> New <br>
Name - nrobinso42 <br>
choose folder sgoinfre <br>
choose linux <br>
choose Debien64 (downloaded to sgoinfre) <br>
memory 1024mb <br>
Create Virtual harddisk now <br>
choose VDI <br>
choose Dynamically allocated <br>
8 gb disksize <br>
start <br>
install <br>
follow screenshots <br>

************************************* <br>

![Screenshot from 2023-12-26 09-03-25](https://github.com/NigeParis/42-Born_2_be_Root/assets/128382762/44add0e7-954b-4cf8-881e-3eec17fe77da)

![Screenshot from 2023-12-26 09-04-15](https://github.com/NigeParis/42-Born_2_be_Root/assets/128382762/12e2df01-539c-49a7-a573-094c131d397d)

![Screenshot from 2023-12-26 09-04-23](https://github.com/NigeParis/42-Born_2_be_Root/assets/128382762/7091f6e1-a731-4af8-b7cb-2f3d39734a4d)

![Screenshot from 2023-12-26 09-04-29](https://github.com/NigeParis/42-Born_2_be_Root/assets/128382762/8e2516d2-16cd-4e61-80c3-4477ae48c2e6)

![Screenshot from 2023-12-26 09-04-38](https://github.com/NigeParis/42-Born_2_be_Root/assets/128382762/5a8070d6-d2ed-4a8a-b9f4-93b44c9d09a1)

![Screenshot from 2023-12-26 09-04-47](https://github.com/NigeParis/42-Born_2_be_Root/assets/128382762/e5d25a28-fa1a-4460-a0c5-3c16667ef839)

![Screenshot from 2023-12-26 09-05-36](https://github.com/NigeParis/42-Born_2_be_Root/assets/128382762/2318ca95-3ed6-436d-986e-50748c297fff)

![Screenshot from 2023-12-26 09-05-51](https://github.com/NigeParis/42-Born_2_be_Root/assets/128382762/7dcc37ca-ccb6-4782-a622-e2731de2d9ba)

![Screenshot from 2023-12-26 09-07-20](https://github.com/NigeParis/42-Born_2_be_Root/assets/128382762/4de1112f-6ffb-4a8a-a343-46b2a65093f4)

![Screenshot from 2023-12-26 09-09-17](https://github.com/NigeParis/42-Born_2_be_Root/assets/128382762/09d2af23-9c8c-4439-a256-efb3ed5ad147)

![Screenshot from 2023-12-26 09-09-59](https://github.com/NigeParis/42-Born_2_be_Root/assets/128382762/361f6a35-e9c3-4103-8d2e-01ee78894210)

![Screenshot from 2023-12-26 09-11-06](https://github.com/NigeParis/42-Born_2_be_Root/assets/128382762/a742a3cb-9bc2-4bf4-8c9a-0737b5df5d26)

![Screenshot from 2023-12-26 09-12-01](https://github.com/NigeParis/42-Born_2_be_Root/assets/128382762/9f839d9f-43e2-4358-ba8a-1d6259d6939c)

![Screenshot from 2023-12-26 09-12-18](https://github.com/NigeParis/42-Born_2_be_Root/assets/128382762/60c16d94-7f6d-481c-9279-1af8d40fc602)

![Screenshot from 2023-12-26 09-12-43](https://github.com/NigeParis/42-Born_2_be_Root/assets/128382762/b60fe525-a980-49c4-96f1-c56c2b94216e)

![Screenshot from 2023-12-26 09-13-13](https://github.com/NigeParis/42-Born_2_be_Root/assets/128382762/d9d2e07d-856a-42a3-bfe6-d266e05632e4)

![Screenshot from 2023-12-26 09-13-26](https://github.com/NigeParis/42-Born_2_be_Root/assets/128382762/05bf5ba9-3613-4303-9770-20db7cb430d7)

![Screenshot from 2023-12-26 09-14-24](https://github.com/NigeParis/42-Born_2_be_Root/assets/128382762/31a0419e-68ea-4d60-8172-778c961d1413)

![Screenshot from 2023-12-26 09-14-38](https://github.com/NigeParis/42-Born_2_be_Root/assets/128382762/91d2ba4a-2293-429d-baf8-8188e6947c55)

![Screenshot from 2023-12-26 09-16-09](https://github.com/NigeParis/42-Born_2_be_Root/assets/128382762/a2b21a6e-f247-44a5-8e56-a70c2e7abcb6)

![Screenshot from 2023-12-26 09-16-21](https://github.com/NigeParis/42-Born_2_be_Root/assets/128382762/cbaa3234-fc17-4660-ad13-fb7c23e60dfb)

![Screenshot from 2023-12-26 09-16-57](https://github.com/NigeParis/42-Born_2_be_Root/assets/128382762/59d93827-8ec6-4b35-8a2d-d162ae9494de)

![Screenshot from 2023-12-26 09-17-10](https://github.com/NigeParis/42-Born_2_be_Root/assets/128382762/53e013bc-77c1-4692-85bb-eb5306eafb6b)

![Screenshot from 2023-12-26 09-21-30](https://github.com/NigeParis/42-Born_2_be_Root/assets/128382762/e6b63282-0251-4f19-87f0-6a1f235df501)

![Screenshot from 2023-12-26 09-22-36](https://github.com/NigeParis/42-Born_2_be_Root/assets/128382762/2173b5b2-13f9-4706-9f44-75d4a0a88c0c)

![Screenshot from 2023-12-26 09-23-07](https://github.com/NigeParis/42-Born_2_be_Root/assets/128382762/9735bc2c-78e3-4201-83a0-67e521608e22)

![Screenshot from 2023-12-26 09-23-23](https://github.com/NigeParis/42-Born_2_be_Root/assets/128382762/a8134fc6-a908-410f-8eb2-1bea9e7c2c21)

![Screenshot from 2023-12-26 09-25-42](https://github.com/NigeParis/42-Born_2_be_Root/assets/128382762/1ed5468e-4ec3-44a9-b23d-2361b0505ea6)

![Screenshot from 2023-12-26 09-26-03](https://github.com/NigeParis/42-Born_2_be_Root/assets/128382762/9a7718a7-9c07-4043-b733-d813893d4546)

![Screenshot from 2023-12-26 09-26-09](https://github.com/NigeParis/42-Born_2_be_Root/assets/128382762/0d8116f0-c802-44af-8088-80c1fbe977dd)

![Screenshot from 2023-12-26 09-26-24](https://github.com/NigeParis/42-Born_2_be_Root/assets/128382762/691e7229-8379-414c-bc14-45f956b82e59)

![Screenshot from 2023-12-26 09-27-23](https://github.com/NigeParis/42-Born_2_be_Root/assets/128382762/80068d84-3b41-494a-9e11-a1e0004a1ef2)

![Screenshot from 2023-12-26 09-27-44](https://github.com/NigeParis/42-Born_2_be_Root/assets/128382762/4972a979-6fbe-4a4f-b4dd-7ff286451505)

![Screenshot from 2023-12-26 09-28-13](https://github.com/NigeParis/42-Born_2_be_Root/assets/128382762/3d1a20ff-21a1-4e90-a127-cb8c8fe574ad)

![Screenshot from 2023-12-26 09-28-21](https://github.com/NigeParis/42-Born_2_be_Root/assets/128382762/7c21cc92-4e65-4067-a527-2e17337bdef0)

![Screenshot from 2023-12-26 09-29-54](https://github.com/NigeParis/42-Born_2_be_Root/assets/128382762/9afe372a-e29e-4022-b59f-62ece0b796d3)

![Screenshot from 2023-12-26 09-30-29](https://github.com/NigeParis/42-Born_2_be_Root/assets/128382762/c49990da-fd6f-4dc3-bde0-878bf98a9253)

## **************** #Basic setup ********************** <br>
de-crypt disk with passphrase. <br>
login root <br>
check disk -> lsblk (voir screenshot below) <br>
apt-get update <br>
apt-get upgrade <br>
apt-get install sudo <br>
sudo usermod -aG sudo nige <br>
check sudo group -> getent group sudo <br>
reboot <br>
connect with user (my case nige) <br>

sudo groupadd user42 <br>
sudo usermod -aG user42 nige <br>
sudo apt-get install vim <br>

![Screenshot from 2023-12-26 09-35-38](https://github.com/NigeParis/42-Born_2_be_Root/assets/128382762/552751fb-286c-483b-9dba-92608b5542f7)

## ***** setup remote SSH ***** <br>
sudo apt-get install openssh-server <br>
sudo systemctl status ssh  <br>
ip a (get ip adress) <br>
add port 4242 <br>
cd /etc/ssh <br>
sudo vim sshd_config <br>
edit #port 22 to port 4242 <br>

## ***** install firewall UFW ***** <br>
sudo apt-get install ufw <br>
sudo ufw enable  <br>
sudo ufw status <br>

## ***** config Network Adapter 1 in VM ***** <br>
Network -> Adapter 1 <br>
Host Port 4241 Guest Port 4242 <br>
sudo reboot <br>
sudo ufw allow 4242/tcp <br>

## ***** connection ssh ****** <br>
connect user (nige) <br>
open terminal (poste 42) <br>
ssh -p 4241 nige@127.0.0.1 <br>
enter password <br>

## ***** Password setup ****** <br>
sudo apt-get install libpam-pwquality <br>
cd /etc/ <br>
sudo vim login.defs <br>
change : <br>
	PASS_MAX_DAYS 30 <br>
	pass_min_days 2 <br>
	pass_warn_age 7 <br>
cd /etc/pam.d <br>
sudo vim common-password <br>
add to line : password requisite pam_pwquality.so retry=3 <br>
 
one uppercase                      : ucredit=-1 <br>
one lowercase                      : lcredit=-1 <br>
one digit                          : dcredit=-1 <br>
min len                            : minlen=10 <br>
max consec identical in pw         : maxrepeat=3 <br>
check if pw contains username      : usercheck=0 <br>
set mini nb chars diff from old pw : difok=7 <br>
root pw comply to rules add        : enforce_for_root <br>

sudo reboot <br>

## ***** sudo setup ****** <br>
cd /etc/sudoers.d <br>
sudo visudo <br>

Defaults	env_reset <br>
Defaults	mail_badpass <br>
Defaults	secure_path="/usr/local/sbin:/usr/local/bin:/usr/bin:/sbin:/bin" <br>
Defaults	badpass_message="Password is wrong, please try again!" <br>
Defaults	passwd_tries=3 <br>
Defaults	logfile="/var/log/sudo/sudo.log" <br>
Defaults	log_input, log_output <br>
Defaults	requiretty <br>

## ***** script monitoring.sh ***** <br>
sudo vim /usr/local/bin/monitoring.sh <br>
sudo apt-get install net-tools <br> <br>
## ************** monitoring.sh script ********* <br>

#!/bin/bash <br>
arc=$(uname -a) <br>
pcpu=$(grep "physical id" /proc/cpuinfo | sort | uniq | wc -l)  <br>
vcpu=$(grep "^processor" /proc/cpuinfo | wc -l) <br>
fram=$(free -m | awk '$1 == "Mem:" {print $2}') <br>
uram=$(free -m | awk '$1 == "Mem:" {print $3}') <br>
pram=$(free | awk '$1 == "Mem:" {printf("%.2f"), $3/$2*100}') <br>
fdisk=$(df -BG | grep '^/dev/' | grep -v '/boot$' | awk '{ft += $2} END {print ft}') <br>
udisk=$(df -BM | grep '^/dev/' | grep -v '/boot$' | awk '{ut += $3} END {print ut}') <br>
pdisk=$(df -BM | grep '^/dev/' | grep -v '/boot$' | awk '{ut += $3} {ft+= $2} END {printf("%d"), ut/ft*100}') <br>
cpul=$(top -bn1 | grep '^%Cpu' | cut -c 9- | xargs | awk '{printf("%.1f%%"), $1 + $3}') <br>
lb=$(who -b | awk '$1 == "system" {print $3 " " $4}') <br>
lvmu=$(if [ $(lsblk | grep "lvm" | wc -l) -eq 0 ]; then echo no; else echo yes; fi) <br>
ctcp=$(ss -neopt state established | wc -l) <br>
ulog=$(users | wc -w) <br>
ip=$(hostname -I) <br>
mac=$(ip link show | grep "ether" | awk '{print $2}') <br>
cmds=$(journalctl _COMM=sudo | grep COMMAND | wc -l) <br>
wall "	#Architecture: $arc <br>
	#CPU physical: $pcpu <br>
	#vCPU: $vcpu <br>
	#Memory Usage: $uram/${fram}MB ($pram%) <br>
	#Disk Usage: $udisk/${fdisk}Gb ($pdisk%) <br>
	#CPU load: $cpul <br>
	#Last boot: $lb <br>
	#LVM use: $lvmu <br>
	#Connections TCP: $ctcp ESTABLISHED <br>
	#User log: $ulog <br>
	#Network: IP $ip ($mac) <br>
	#Sudo: $cmds cmd" <br>


*********************************** <br>
sudo reboot <br>
bash /usr/local/bin/monitoring.sh -> to see results of script <br>

next configure - 10 mins interval to run script <br>

sudo crontab -u root -e  <- access script to lanch <br>
add : */10 * * * * /usr/local/bin/monitoring.sh <br>

note : order stars ***** minutes,  hours, day of the month, month, day of week <br>


********************************************************** <br>

## Evaluation codes <br>

sudo ufw status <br>
sudo systemctl status ssh <br>
getent group sudo <br>
getent group user42 <br>
sudo adduser new username <br>
sudo groupadd groupname <br>
sudo usermod -aG groupname username <br>
sudo chage -l username - check password expire rules <br>
hostnamectl <br>
hostnamectl set-hostname new_hostname - to change the current hostname <br>
Restart your Virtual Machine. <br>
sudo nano /etc/hosts - change current hostname to new hostname <br>
lsblk to display the partitions <br>
dpkg -l | grep sudo – to show that sudo is installed <br>
sudo ufw status numbered <br>
sudo ufw allow port-id <br>
sudo ufw delete rule number <br>
